---
title: 'Aufgabenblatt 02: Generalisierte lineare Modelle'
author: "Anatol"
date: "3/22/2022"
output: 
  html_document:
    code_folding: hide
    df_print: kable
    fig_caption: yes
    fig_height: 5
    fig_width: 5
    theme: united
    self_contained: yes
    toc: yes
    toc_float: yes
    toc_level: 3
---

```{r, include = FALSE}
library(dplyr)
library(magrittr)
library(flair)
library(pipeR)
library(knitr)
library(rmarkdown)
library(shiny)
library(shinyWidgets)
library(arm)
library(rAmCharts)
library(xfun)
library(car)
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}

xfun::pkg_load2(c("htmltools", "mime"))
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{css, echo=FALSE}
.description {
  color: gray;
  font-style: italics;
```

# Aufgabe 1: Logit Modelle
```{r}
insur <- read.csv("insurance.csv")
head(insur)
str(insur)
summary(insur)
```
```{r}
any(is.na(insur))
```

```{r}
hist(insur$hhincome, breaks = 100, prob = TRUE)
```

## 1a)
*Aufgrund der Rechtsschiefe des Einkommens entscheiden Sie sich fur eine Logarithmierung. Addieren Sie zur Vermeidung von NAs dabei zur Ursprungsvariable zunachst die Konstante 0,001. Dummyvariablen sollten Sie zunachst zu Faktoren umwandeln.*

```{r}
summary(insur$hhincome)
insur$loghhincome <- insur$hhincome + 0.001
summary(insur$loghhincome)
insur$loghhincome <- log(insur$loghhincome)
summary(insur$loghhincome)
```


```{r}
hist(insur$loghhincome, breaks = 100, prob = TRUE)
```
```{r}
insur$ins <- as.factor(insur$ins)
insur$married <- as.factor(insur$married)
insur$retire <- as.factor(insur$retire)
insur$hstatusg <- as.factor(insur$hstatusg)
insur$hisp <- as.factor(insur$hisp)
str(insur)
```
## 1b)
*b) Passen Sie zunachst einmal das volle Modell an und nutzen Sie dabei den Logit-Link.*
```{r}
logRegFull <- glm(ins ~ married + retire + hstatusg + hhincome + 
                   age + hisp + educyear, family = binomial(link = "logit"), data = insur)
summary(logRegFull)
```
## 1c)
*Zur Diagnostik schauen Sie sich den binned residual plot an. Dazu verwenden Sie die Funktion binnedplot aus dem arm-Paket und plotten die geﬁtteten Werte auf die Abszisse und die Residuen auf die Ordinate. Wie
interpretieren Sie die Graﬁk? Die Funktion binned.resids mit den bereits zum Plotten genutzten Argumenten
konnte Ihnen hier helfen.*

```{r}
binnedplot(logRegFull$fitted.values, logRegFull$residuals)
binned.resids(logRegFull$fitted.values, logRegFull$residuals)
```

Die Residuen scheinen im Mittelwert Null zu sein und konstante Varianz (Homoskedastizitat) zu haben.

## 1d)
*Interpretieren Sie zunachst ganz allgemein die Regressionskoeﬃzienten Ihres Modells. Wie verandert sich c.p. durch eine Heirat die Chance, krankenversichert zu sein? Wie vera¨ndert sich c.p. die Chance, wenn eine Person ein weiteres Ausbildungsjahr absolviert hat?*




